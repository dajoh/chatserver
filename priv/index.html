<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Chatserver Interface</title>
		<link href="css/bootstrap.min.css" rel="stylesheet" />
		<style>
			body {
				padding-top: 40px;
				padding-bottom: 40px;
				background-color: #fff;
			}
			.chat-small-panel {
				margin: 0 auto;
				max-width: 330px;
			}
			.chat-medium-panel {
				margin: 0 auto;
				max-width: 660px;
			}
			#chat-log {
				padding: 0;
				list-style: none;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<!-- Connecting panel -->
			<div id="conn-msg" class="panel panel-info chat-small-panel">
				<div class="panel-heading">Connecting to chat server</div>
				<div class="panel-body">Hang on for just a second...</div>
			</div>

			<!-- Error panel -->
			<div id="conn-err" class="panel panel-danger chat-small-panel">
				<div class="panel-heading">Error</div>
				<div class="panel-body">Connection to chat server lost! :(</div>
			</div>

			<!-- Set name panel -->
			<form id="form-name">
				<div class="panel panel-default chat-small-panel">
					<div class="panel-heading">Set name</div>
					<div class="panel-body">
						<p>Please enter your display name</p>
						<div class="input-group">
							<span class="input-group-addon">
								<span class="glyphicon glyphicon-user"></span>
							</span>
							<input id="chat-name" type="text" class="form-control" placeholder="Name" required />
							<span class="input-group-btn">
								<button id="chat-set-name" class="btn btn-primary" type="submit">Set</button>
							</span>
						</div>
					</div>
				</div>
			</form>

			<!-- Chat panel -->
			<form id="form-chat">
				<div class="panel panel-default chat-medium-panel">
					<div class="panel-heading">Chat</div>
					<div class="panel-body">
						<ol id="chat-log">
							<li>Welcome to the chat room!</li>
							<li></li>
						</ol>
						<div class="input-group">
							<span class="input-group-addon">
								<span class="glyphicon glyphicon-pencil"></span>
							</span>
							<input id="chat-msg" type="text" class="form-control" placeholder="Message" required />
							<span class="input-group-btn">
								<button id="chat-send" class="btn btn-primary" type="submit">Send</button>
							</span>
						</div>
					</div>
				</div>
			</form>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			var socket = new WebSocket("ws://" + window.location.host + "/ws");

			var connMsg = $("#conn-msg");
			var connErr = $("#conn-err");
			var nameForm = $("#form-name");
			var chatForm = $("#form-chat");

			var chatName = $("#chat-name");
			var chatSetName = $("#chat-set-name");

			var chatLog = $("#chat-log");
			var chatMsg = $("#chat-msg");
			var chatSend = $("#chat-send");

			connMsg.hide();
			connErr.hide();
			nameForm.hide();
			chatForm.hide();
			connMsg.fadeIn(500);

			socket.onopen = function() {
				connMsg.fadeOut(500, function() {
					nameForm.fadeIn(500);
					chatName.focus();
				});
			};

			socket.onmessage = function(msg) {
				// wow such escape
				$("<li></li>").text(msg.data).appendTo("#chat-log");
				// oh my god i'm lazy
				window.scrollTo(0,document.body.scrollHeight);
			};

			socket.onclose = function() {
				connMsg.hide();
				nameForm.hide();
				chatForm.hide();
				connErr.fadeIn(500);
			};

			chatSetName.click(function(e) {
				e.preventDefault();
				if(chatName.val() != "") {
					socket.send(chatName.val());
					nameForm.fadeOut(500, function() {
						chatForm.fadeIn(500);
						chatMsg.focus();
					});
				}
			});

			chatSend.click(function(e) {
				e.preventDefault();
				if(chatMsg.val() != "") {
					socket.send(chatMsg.val());
					chatMsg.val("");
				}
			});
		</script>
	</body>
</html>
